@model ASI.Basecode.Services.ServiceModels.UserPageViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Navbar -->
    <nav>
        <div class="navList">
            <div class="navItem">
                <a href="#" class="navItemA active">Dashboard</a>
            </div>
            <div class="navItem">
                <a href="admin-bookings.html" class="navItemA">Bookings</a>
            </div>
            <div class="navItem">
                <a href="#" class="navItemA">Rooms</a>
            </div>
            <div class="navItem">
                <a href="#" class="navItemA">Users</a>
            </div>
            <div class="navItem">
                <a href="#" class="navItemA">Analytics</a>
            </div>
            <div class="navIndicator"></div> <!-- Indicator -->
        </div>
        <div class="hamburger">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </div>
    </nav>
    <div class="menubar">
        <ul>
            <li>
                <a href="#">Home</a>
            </li>
            <li>
                <a href="#">Services</a>
            </li>
            <li>
                <a href="#">Blog</a>
            </li>
            <li>
                <a href="#">Contact Us</a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <main class="mainBody">
        <div class="mainBodyInner">
            <div class="bookingsDashboard userDashboard">
                <div class="bookingsDashboardHeader">
                    <p class="bookingsDashboardTitle">Users</p>
                    <div class="users-inputGroup">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search name, role, email" aria-label="Recipient's username" aria-describedby="button-addon2">
                            <button class="btn btn-outline-secondary" type="button" id="button-addon2"><i class="bi bi-search"></i></button>
                        </div>
                        <button class="btn adminAddUserBtn" type="button" data-bs-toggle="offcanvas" data-bs-target="#addUsers" aria-controls="addUsers">
                            <i class="bi bi-plus-square me-2"></i><p class="addUserText">Add User</p>
                        </button>
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="table table-striped align-middle" id="adminUserTable">
                        <thead>
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Name</th>
                                <th scope="col">Email</th>
                                <th scope="col">Role</th>
                                <th scope="col">Date Created</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Rows will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Add User Offcanvas -->
        <div class="offcanvas offcanvas-end" data-bs-backdrop="static" tabindex="-1" id="addUsers" aria-labelledby="staticBackdropLabel">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="staticBackdropLabel">Add User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div class="offcanvas-body-inner">
                    <div class="offcanvas-body-innerMost">
                        <div>
                            <div class="mb-3">
                                <label for="userFirstNameInput" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="userFirstNameInput" placeholder="">
                            </div>
                            <div class="mb-3">
                                <label for="userLastNameInput" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="userLastNameInput" placeholder="">
                            </div>
                            <div class="mb-3">
                                <label for="userEmailInput" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="userEmailInput" placeholder="name@example.com">
                            </div>
                            <div>
                                <label for="userRoleAdd" class="form-label">Role</label>
                                <select class="form-select" aria-label="Default select example" id="userRoleAdd">
                                    <option selected>Role</option>
                                    <option value="User">User</option>
                                    <option value="Staff">Staff</option>
                                    <option value="Admin">Admin</option>
                                </select>
                            </div>
                        </div>
                        <div class="buttonsOffCanvas">
                            <button type="button" class="btn btn-outline-secondary">Cancel</button>
                            <button class="btn adminAddUserBtn" type="button"><i class="bi bi-plus-square me-2"></i>Add User</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit User Modal -->
        <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="mb-3">
                                <label for="editUserNameInput" class="form-label">Name</label>
                                <input type="text" class="form-control" id="editUserNameInput">
                            </div>
                            <div class="mb-3">
                                <label for="editUserEmailInput" class="form-label">Email</label>
                                <input type="email" class="form-control" id="editUserEmailInput">
                            </div>
                            <div class="mb-3">
                                <label for="editUserRoleInput" class="form-label">Role</label>
                                <select class="form-select" id="editUserRoleInput">
                                    <option value="User">User</option>
                                    <option value="Staff">Staff</option>
                                    <option value="Admin">Admin</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // Function to render users table
        function renderUsers(users) {
            const tbody = document.querySelector('#adminUserTable tbody');
            tbody.innerHTML = ''; // Clear previous rows

            users.forEach((user, index) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                            <td>${user.id}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>${user.role}</td>
                            <td>${user.date_created}</td>
                            <td class="actionBtnUsers">
                                <i class="bi bi-pencil-square editIconBtn" onclick="editUser(${index})"></i>
                                <i class="bi bi-trash3 ms-2 deleteIconBtn" onclick="deleteUser(${index})"></i>
                            </td>
                        `;

                tbody.appendChild(row);
            });
        }

        // Edit User function to open the modal with pre-populated data
        function editUser(index) {
            const userData = users[index];

            // Populate the modal fields with user data
            document.getElementById('editUserNameInput').value = userData.name;
            document.getElementById('editUserEmailInput').value = userData.email;
            document.getElementById('editUserRoleInput').value = userData.role;

            // Show the modal
            const editUserModal = new bootstrap.Modal(document.getElementById('editUserModal'));
            editUserModal.show();
        }

        // Delete User function
        function deleteUser(index) {
            if (confirm(`Are you sure you want to delete user: ${users[index].name}?`)) {
                users.splice(index, 1);
                renderUsers(users); // Re-render table after deletion
            }
        }

        // Fetch users from JSON file
        fetch('/data/users.json') // Ensure this path is correct for your setup
            .then(response => response.json())
            .then(data => {
                users = data; // Store the fetched user data in a global variable
                renderUsers(users); // Render users using the fetched data
            })
            .catch(error => console.error('Error fetching user data:', error));
    </script>
</body>

</html>
</html>